<!DOCTYPE html>
<html class="no-js" lang="en">


<!-- Mirrored from wp.alithemes.com/html/evara/evara-frontend/shop-checkout.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 01 Aug 2021 15:26:06 GMT -->
<head>
    <meta charset="utf-8">
    <title>Evara - eCommerce HTML Template</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="">
    <meta property="og:type" content="">
    <meta property="og:url" content="">
    <meta property="og:image" content="">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="assets/imgs/theme/favicon.svg">
    <!-- Template CSS -->
    <link rel="stylesheet" href="assets/css/main.css">
    <style>
        .table-responsive {
  overflow-x: auto;
}

.table {
  width: 100%;
  border-collapse: collapse;
}

.table th, .table td {
  padding: 12px;
  text-align: left;
  border-bottom: 1px solid #ddd;
}

.table thead th {
  background-color: #f8f9fa;
  font-weight: bold;
}

.product-thumbnail {
  max-width: 80px;
  height: auto;
}

.summary-row th {
  text-align: right;
}

.summary-row.total {
  font-weight: bold;
}

.font-xl {
  font-size: 1.25rem;
}

.text-brand {
  color: #007bff;
}

.fw-900 {
  font-weight: 900;
}

.modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgb(0,0,0);
        background-color: rgba(0,0,0,0.4);
    }

    .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    .coupon-item button {
    background-color: #088178;
    color: white;
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
}

.coupon-item button:hover {
    background-color: #066b5c;
}

.modal {
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.5);
}

.modal-content {
    background-color: #fff;
    margin: 15% auto;
    padding: 20px;
    border-radius: 8px;
    width: 40%;
    text-align: center;
}

.btn {
    padding: 10px 20px;
    margin: 10px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.btn-primary {
    background-color: #3399cc;
    color: #fff;
}

.btn-secondary {
    background-color: #ccc;
    color: #333;
}


  .toast {
    display: flex;
    align-items: center;
    background-color: #333;
    color: #fff;
    padding: 10px 15px;
    border-radius: 5px;
    margin-bottom: 10px;
    animation: fadeInOut 4s ease-in-out;
  }
  .toast.success { background-color: #4caf50; }
  .toast.error { background-color: #f44336; }
  .toast.warning { background-color: #ff9800; }
  @keyframes fadeInOut {
    0% { opacity: 0; transform: translateX(100%); }
    10% { opacity: 1; transform: translateX(0); }
    90% { opacity: 1; }
    100% { opacity: 0; transform: translateX(100%); }
  }



    </style>
</head>

<body>
    <header class="header-area header-style-5">
        <div class="header-top header-top-ptb-1 d-none d-lg-block">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-xl-3 col-lg-4">
                        <div class="header-info">
                            <ul>
                                <li><i class="fi-rs-smartphone"></i> <a href="#">(+01) - 2345 - 6789</a></li>
                                <li><i class="fi-rs-marker"></i><a  href="page-contact.html">Our location</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-xl-6 col-lg-4">
                        <div class="text-center">
                            <div id="news-flash" class="d-inline-block">
                                <ul>
                                    <li>Get great devices up to 50% off <a href="shop-grid-right.html">View details</a></li>
                                    <li>Supper Value Deals - Save more with coupons</li>
                                    <li>Trendy 25silver jewelry, save up 35% off today <a href="shop-grid-right.html">Shop now</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-4">
                        <div class="header-info header-info-right">
                            <ul>
                                <li>
                                    <a class="language-dropdown-active" href="#"> <i class="fi-rs-world"></i> English <i class="fi-rs-angle-small-down"></i></a>
                                    <ul class="language-dropdown">
                                        <li><a href="#"><img src="assets/imgs/theme/flag-fr.png" alt="">Français</a></li>
                                        <li><a href="#"><img src="assets/imgs/theme/flag-dt.png" alt="">Deutsch</a></li>
                                        <li><a href="#"><img src="assets/imgs/theme/flag-ru.png" alt="">Pусский</a></li>
                                    </ul>
                                </li>
                                <li><i class="fi-rs-user"></i><a href="page-login-register.html">Log In / Sign Up</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="header-bottom sticky-bar sticky-white-bg">
            <div class="container">
                <div class="header-wrap header-space-between position-relative">
                    <div class="logo logo-width-1">
                        <a href="index.html"><img src="assets/imgs/theme/logo.svg" alt="logo"></a>
                    </div>
                    <div class="main-menu main-menu-grow main-menu-padding-1 main-menu-lh-1 main-menu-mrg-1 hm3-menu-padding d-none d-lg-block hover-boder">
                        <nav>
                            <ul>
                                <li><a class="active" href="/user/home">Home</a>
                            
                                </li>
                                <li><a href="/user/shop">Shop</a>
                                    
                                </li>
                                <li ><a href="/user/myaccount">My Profile</a>
                                
                                
                                
                                
                            </ul>
                        </nav>
                    </div>
                    <div class="header-action-right">
                        
                        <div class="header-action-2">
                            <div class="header-action-icon-2">
                                <a href="/user/wishlist">
                                    <img class="svgInject" alt="Evara" src="assets/imgs/theme/icons/icon-heart.svg">
                                    
                                </a>
                            </div>
                            <div class="header-action-icon-2">
                                <a class="mini-cart-icon" href="/user/cart">
                                    <img alt="Evara" src="assets/imgs/theme/icons/icon-cart.svg">
                                    
                                </a>
                               
                            </div>
                            <div class="header-action-icon d-block d-lg-none">
                                <div class="burger-icon">
                                    <span class="burger-icon-top"></span>
                                    <span class="burger-icon-mid"></span>
                                    <span class="burger-icon-bottom"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <div class="mobile-header-active mobile-header-wrapper-style">
        <div class="mobile-header-wrapper-inner">
            <div class="mobile-header-top">
                <div class="mobile-header-logo">
                    <a href="index.html"><img src="assets/imgs/theme/logo.svg" alt="logo"></a>
                </div>
                <div class="mobile-menu-close close-style-wrap close-style-position-inherit">
                    <button class="close-style search-close">
                        <i class="icon-top"></i>
                        <i class="icon-bottom"></i>
                    </button>
                </div>
            </div>
            <div class="mobile-header-content-area">
                <div class="mobile-search search-style-3 mobile-header-border">
                    <form action="#">
                        <input type="text" placeholder="Search for items…">
                        <button type="submit"><i class="fi-rs-search"></i></button>
                    </form>
                </div>
                <div class="mobile-menu-wrap mobile-header-border">
                    <div class="main-categori-wrap mobile-header-border">
                        <a class="categori-button-active-2" href="#">
                            <span class="fi-rs-apps"></span> Browse Categories
                        </a>
                        <div class="categori-dropdown-wrap categori-dropdown-active-small">
                            <ul>
                                <li><a href="shop-grid-right.html"><i class="evara-font-dress"></i>Women's Clothing</a></li>
                                <li><a href="shop-grid-right.html"><i class="evara-font-tshirt"></i>Men's Clothing</a></li>
                                <li> <a href="shop-grid-right.html"><i class="evara-font-smartphone"></i> Cellphones</a></li>
                                <li><a href="shop-grid-right.html"><i class="evara-font-desktop"></i>Computer & Office</a></li>
                                <li><a href="shop-grid-right.html"><i class="evara-font-cpu"></i>Consumer Electronics</a></li>
                                <li><a href="shop-grid-right.html"><i class="evara-font-home"></i>Home & Garden</a></li>
                                <li><a href="shop-grid-right.html"><i class="evara-font-high-heels"></i>Shoes</a></li>
                                <li><a href="shop-grid-right.html"><i class="evara-font-teddy-bear"></i>Mother & Kids</a></li>
                                <li><a href="shop-grid-right.html"><i class="evara-font-kite"></i>Outdoor fun</a></li>
                            </ul>
                        </div>
                    </div>
                    <!-- mobile menu start -->
                    <nav>
                        <ul class="mobile-menu">
                            <li class="menu-item-has-children"><span class="menu-expand"></span><a href="index.html">Home</a>
                                <ul class="dropdown">
                                    <li><a href="index.html">Home 1</a></li>
                                    <li><a href="index-2.html">Home 2</a></li>
                                    <li><a href="index-3.html">Home 3</a></li>
                                    <li><a href="index-4.html">Home 4</a></li>
                                </ul>
                            </li>
                            <li class="menu-item-has-children"><span class="menu-expand"></span><a href="shop-grid-right.html">shop</a>
                                <ul class="dropdown">
                                    <li><a href="shop-grid-right.html">Shop Grid – Right Sidebar</a></li>
                                    <li><a href="shop-grid-left.html">Shop Grid – Left Sidebar</a></li>
                                    <li><a href="shop-list-right.html">Shop List – Right Sidebar</a></li>
                                    <li><a href="shop-list-left.html">Shop List – Left Sidebar</a></li>
                                    <li><a href="shop-fullwidth.html">Shop - Wide</a></li>
                                    <li class="menu-item-has-children"><span class="menu-expand"></span><a href="#">Single Product</a>
                                        <ul class="dropdown">
                                            <li><a href="shop-product-right.html">Product – Right Sidebar</a></li>
                                            <li><a href="shop-product-left.html">Product – Left Sidebar</a></li>
                                            <li><a href="shop-product-full.html">Product – No sidebar</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="shop-filter.html">Shop – Filter</a></li>
                                    <li><a href="shop-wishlist.html">Shop – Wishlist</a></li>
                                    <li><a href="shop-cart.html">Shop – Cart</a></li>
                                    <li><a href="shop-checkout.html">Shop – Checkout</a></li>
                                    <li><a href="shop-compare.html">Shop – Compare</a></li>
                                </ul>
                            </li>
                            <li class="menu-item-has-children"><span class="menu-expand"></span><a href="#">Mega menu</a>
                                <ul class="dropdown">
                                    <li class="menu-item-has-children"><span class="menu-expand"></span><a href="#">Women's Fashion</a>
                                        <ul class="dropdown">
                                            <li><a href="shop-product-right.html">Dresses</a></li>
                                            <li><a href="shop-product-right.html">Blouses & Shirts</a></li>
                                            <li><a href="shop-product-right.html">Hoodies & Sweatshirts</a></li>
                                            <li><a href="shop-product-right.html">Women's Sets</a></li>
                                        </ul>
                                    </li>
                                    <li class="menu-item-has-children"><span class="menu-expand"></span><a href="#">Men's Fashion</a>
                                        <ul class="dropdown">
                                            <li><a href="shop-product-right.html">Jackets</a></li>
                                            <li><a href="shop-product-right.html">Casual Faux Leather</a></li>
                                            <li><a href="shop-product-right.html">Genuine Leather</a></li>
                                        </ul>
                                    </li>
                                    <li class="menu-item-has-children"><span class="menu-expand"></span><a href="#">Technology</a>
                                        <ul class="dropdown">
                                            <li><a href="shop-product-right.html">Gaming Laptops</a></li>
                                            <li><a href="shop-product-right.html">Ultraslim Laptops</a></li>
                                            <li><a href="shop-product-right.html">Tablets</a></li>
                                            <li><a href="shop-product-right.html">Laptop Accessories</a></li>
                                            <li><a href="shop-product-right.html">Tablet Accessories</a></li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li class="menu-item-has-children"><span class="menu-expand"></span><a href="blog-category-fullwidth.html">Blog</a>
                                <ul class="dropdown">
                                    <li><a href="blog-category-grid.html">Blog Category Grid</a></li>
                                    <li><a href="blog-category-list.html">Blog Category List</a></li>
                                    <li><a href="blog-category-big.html">Blog Category Big</a></li>
                                    <li><a href="blog-category-fullwidth.html">Blog Category Wide</a></li>
                                    <li class="menu-item-has-children"><span class="menu-expand"></span><a href="#">Single Product Layout</a>
                                        <ul class="dropdown">
                                            <li><a href="blog-post-left.html">Left Sidebar</a></li>
                                            <li><a href="blog-post-right.html">Right Sidebar</a></li>
                                            <li><a href="blog-post-fullwidth.html">No Sidebar</a></li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li class="menu-item-has-children"><span class="menu-expand"></span><a href="#">Pages</a>
                                <ul class="dropdown">
                                    <li><a href="page-about.html">About Us</a></li>
                                    <li><a href="page-contact.html">Contact</a></li>
                                    <li><a href="page-account.html">My Account</a></li>
                                    <li><a href="page-login-register.html">login/register</a></li>
                                    <li><a href="page-purchase-guide.html">Purchase Guide</a></li>
                                    <li><a href="page-privacy-policy.html">Privacy Policy</a></li>
                                    <li><a href="page-terms.html">Terms of Service</a></li>
                                    <li><a href="page-404.html">404 Page</a></li>
                                </ul>
                            </li>
                            <li class="menu-item-has-children"><span class="menu-expand"></span><a href="#">Language</a>
                                <ul class="dropdown">
                                    <li><a href="#">English</a></li>
                                    <li><a href="#">French</a></li>
                                    <li><a href="#">German</a></li>
                                    <li><a href="#">Spanish</a></li>
                                </ul>
                            </li>
                        </ul>
                    </nav>
                    <!-- mobile menu end -->
                </div>
                <div class="mobile-header-info-wrap mobile-header-border">
                    <div class="single-mobile-header-info mt-30">
                        <a  href="page-contact.html"> Our location </a>
                    </div>
                    <div class="single-mobile-header-info">
                        <a href="page-login-register.html">Log In / Sign Up </a>
                    </div>
                    <div class="single-mobile-header-info">
                        <a href="#">(+01) - 2345 - 6789 </a>
                    </div>
                </div>
                <div class="mobile-social-icon">
                    <h5 class="mb-15 text-grey-4">Follow Us</h5>
                    <a href="#"><img src="assets/imgs/theme/icons/icon-facebook.svg" alt=""></a>
                    <a href="#"><img src="assets/imgs/theme/icons/icon-twitter.svg" alt=""></a>
                    <a href="#"><img src="assets/imgs/theme/icons/icon-instagram.svg" alt=""></a>
                    <a href="#"><img src="assets/imgs/theme/icons/icon-pinterest.svg" alt=""></a>
                    <a href="#"><img src="assets/imgs/theme/icons/icon-youtube.svg" alt=""></a>
                </div>
            </div>
        </div>
    </div>
    <main class="main">
        <div class="page-header breadcrumb-wrap">
            <div class="container">
                <div class="breadcrumb">
                    <a href="index.html" rel="nofollow">Home</a>
                    <span></span> Shop
                    <span></span> Checkout
                </div>
            </div>
        </div>
        <section class="mt-50 mb-50">
            <div class="container">
                <!-- <div class="row"> -->
                    <!-- <div class="col-lg-6 mb-sm-15">
                         <div class="toggle_info">
                            <span><i class="fi-rs-user mr-10"></i><span class="text-muted">Already have an account?</span> <a href="#loginform" data-bs-toggle="collapse" class="collapsed" aria-expanded="false">Click here to login</a></span>
                        </div> 
                        <div class="panel-collapse collapse login_form" id="loginform">
                            <div class="panel-body">
                                <p class="mb-30 font-sm">If you have shopped with us before, please enter your details below. If you are a new customer, please proceed to the Billing &amp; Shipping section.</p>
                                <form method="post">
                                    <div class="form-group">
                                        <input type="text" name="email" placeholder="Username Or Email">
                                    </div>
                                    <div class="form-group">
                                        <input type="password" name="password" placeholder="Password">
                                    </div>
                                    <div class="login_footer form-group">
                                        <div class="chek-form">
                                            <div class="custome-checkbox">
                                                <input class="form-check-input" type="checkbox" name="checkbox" id="remember" value="">
                                                <label class="form-check-label" for="remember"><span>Remember me</span></label>
                                            </div>
                                        </div>
                                        <a href="#">Forgot password?</a>
                                    </div>
                                    <div class="form-group">
                                        <button class="btn btn-md" name="login">Log in</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="toggle_info">
                            <span><i class="fi-rs-label mr-10"></i><span class="text-muted">Have a coupon?</span> <a href="#coupon" data-bs-toggle="collapse" class="collapsed" aria-expanded="false">Click here to enter your code</a></span>
                        </div>
                        <div class="panel-collapse collapse coupon_form " id="coupon">
                            <div class="panel-body">
                                <p class="mb-30 font-sm">If you have a coupon code, please apply it below.</p>
                                <form method="post">
                                    <div class="form-group">
                                        <input type="text" placeholder="Enter Coupon Code...">
                                    </div>
                                    <div class="form-group">
                                        <button class="btn  btn-md" name="login">Apply Coupon</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div> -->
                <div class="row">
                    <div class="col-12">
                        <div class="divider mt-50 mb-50"></div>
                    </div>
                    <div class="col-lg-6">
                        <div class="toggle_info">
                            <span><i class="fi-rs-label mr-10"></i><span class="text-muted">Have a coupon?</span> <a href="#coupon" data-bs-toggle="collapse" class="collapsed" aria-expanded="false">Click here to enter your code</a></span>
                        </div>
                       <!-- Coupon Form -->
                       <div class="panel-collapse collapse coupon_form" id="coupon">
                        <div class="panel-body">
                            <p class="mb-30 font-sm">If you have a coupon code, please apply it below.</p>
                            <div class="form-group">
                                <input type="text" id="couponCode" placeholder="Enter Coupon Code..." class="form-control">
                            </div>
                            <div class="form-group">
                                <button type="button" class="btn btn-md" onclick="showAvailableCoupons()">Show Coupons</button>
                                <!-- <button type="button" class="btn btn-md" onclick="applyCoupon()">Apply Coupon</button> -->
                                <button type="button" class="btn btn-md" onclick="removeCoupon()">Remove Coupon</button>
                            </div>
                        </div>
                    </div>

                        <!-- Coupon Modal -->
                        <div id="couponModal" class="modal">
                            <div class="modal-content">
                                <span class="close" onclick="closeModal()">&times;</span>
                                <h3>Available Coupons</h3>
                                <div id="couponList">
                                    <!-- Coupons will be dynamically injected here -->
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                
               
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-25">
                            
                            <!-- <h4>Billing Details</h4> -->
                        </div>
                        <div class="col-md-8">
                            <div class="tab-content dashboard-content">
                                <div class="tab-pane show active">
                                    <div class="card-header">
                                        <h3 class="mb-0">Address</h3>
                                    </div><br>
                                    
                                    <% address.forEach((row, rowIndex) => { %>
                                        <% row.addressDetails.forEach((details, index) => { %>
                                            <div class="row">
                                                <div class="card-header">
                                                    <h5 class="mb-0">Address <%= index + 1 %></h5>
                                                </div>
                                                <div class="card-body">
                                                    <div>
                                                        <!-- Set default selection for the first address or the one marked as default -->
                                                        <input 
                                                            style="width: 16px; height: 16px;" 
                                                            type="radio" 
                                                            name="addressID" 
                                                            value="<%= details._id %>"
                                                            <% if (details.isDefault || (rowIndex === 0 && index === 0)) { %> 
                                                                checked 
                                                            <% } %> 
                                                            onchange="updateSelectedAddress('<%= details._id %>')"
                                                        >
                                                        <label for="address">Select</label>
                                                    </div>
                                                    <address>
                                                        <%= details.name %>,<br>
                                                        <%= details.address %>,<br>
                                                        <%= details.country %>,<br>
                                                        <%= details.state %>,<br>
                                                        <%= details.city %>,<br>
                                                        <%= details.pincode %><br>
                                                        <%= details.landmark %>
                                                    </address>
                                                </div>
                                            </div>
                                            <br>
                                        <% }); %>
                                    <% }); %>
                                    <br>
                                    <div>
                                        <a href="/user/address" class="btn btn-primary btn-sm rounded">Add New Address</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div id="validation-message" style="color: red; font-weight: bold; display: none; margin-bottom: 10px;"></div>
                        <div class="order_review">
                            <div class="mb-20">
                                <h4>Your Orders</h4>
                            </div>
                            <div class="table-responsive order_table">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Product</th>
                                            <th>Quantity</th>
                                            <th>Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% items.forEach(item => { %>
                                            <tr>
                                                <td class="product-info">
                                                    <% if (item.product.colors && item.product.colors[item.color] && item.product.colors[item.color].images && item.product.colors[item.color].images.length > 0) { %>
                                                        <img src="/uploads/<%= item.product.colors[item.color].images[0] %>" alt="<%= item.product.name %>" class="product-thumbnail">
                                                    <% } %>
                                                    <h5><a href="/product/<%= item.product.id %>">Name: <%= item.product.name %> <br> Color: <%= item.color %></a></h5>
                                                </td>
                                                <td class="product-quantity"><%= item.quantity %></td>
                                                <td class="product-total">₹<%= item.price * item.quantity %></td>
                                            </tr>
                                        <% }); %>
                    
                                        <tr class="summary-row">
                                            <th>SubTotal</th>
                                            <td></td>
                                            <td>₹<%= totalPrice.toFixed(2) %></td>
                                        </tr>
                                        <tr class="summary-row">
                                            <th>Coupon</th>
                                            <td></td>
                                            <td id="couponAmount">₹<%= cart.couponAmount %></td>
                                        </tr>

                                        <tr class="summary-row">
                                            <th>Shipping</th>
                                            <td></td>
                                            <td><% if(totalPrice < 1500){ %>
                                                 50
                                                <%  }else{ %>
                                                    Free Delivery
                                              <%  } %></td>
                                        </tr>

                                        <tr class="summary-row">
                                            <th>GST</th>
                                            <td></td>
                                            <td>₹<%= gstAmount.toFixed(2) %></td>
                                        </tr>
                                        <tr class="summary-row total">
                                            <th>Total</th>
                                            <td></td>
                                            <td class="product-subtotal"><span class="font-xl text-brand fw-900" id="totalPrice">₹<% if(totalPrice < 1500){ %>
                                                <%= totalPrice+50 %>
                                           <% } else { %>
                                            <%= totalPrice.toFixed(2) %>
                                          <% }%></span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                    
                            <div class="payment_method">
                                <div class="mb-25">
                                    <h5>Payment</h5>
                                </div>
                                <div class="payment_option">
                                    <div class="custome-radio">
                                        <input class="form-check-input" type="radio" name="payment_option" value="COD" id="paymentCOD">
                                        <label class="form-check-label" for="paymentCOD">COD</label>
                                    </div>
                                    <div class="custome-radio">
                                        <input class="form-check-input" type="radio" name="payment_option" value="RazorPay" id="paymentPaypal">
                                        <label class="form-check-label" for="paymentPaypal">RazorPay</label>
                                    </div>
                                </div>
                            </div>
                    
                            <button type="button" onclick="placeOrder()" class="btn btn-fill-out btn-block mt-30">Place Order</button>
                        </div>
                    </div>
                    
                </div>
            </div>
        </section>
    </main>
    <footer class="main">
        <section class="newsletter p-30 text-white wow fadeIn animated">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-7 mb-md-3 mb-lg-0">
                        <div class="row align-items-center">
                            <div class="col flex-horizontal-center">
                                <img class="icon-email" src="assets/imgs/theme/icons/icon-email.svg" alt="">
                                <h4 class="font-size-20 mb-0 ml-3">Sign up to Newsletter</h4>
                            </div>
                            <div class="col my-4 my-md-0 des">
                                <h5 class="font-size-15 ml-4 mb-0">...and receive <strong>$25 coupon for first shopping.</strong></h5>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-5">
                        <!-- Subscribe Form -->
                        <form class="form-subcriber d-flex wow fadeIn animated">
                            <input type="email" class="form-control bg-white font-small" placeholder="Enter your email">
                            <button class="btn bg-dark text-white" type="submit">Subscribe</button>
                        </form>
                        <!-- End Subscribe Form -->
                    </div>
                </div>
            </div>
        </section>
        <section class="section-padding footer-mid">
            <div class="container pt-15 pb-20">
                <div class="row">
                    <div class="col-lg-4 col-md-6">
                        <div class="widget-about font-md mb-md-5 mb-lg-0">
                            <div class="logo logo-width-1 wow fadeIn animated">
                                <a href="index.html"><img src="assets/imgs/theme/logo.svg" alt="logo"></a>
                            </div>
                            <h5 class="mt-20 mb-10 fw-600 text-grey-4 wow fadeIn animated">Contact</h5>
                            <p class="wow fadeIn animated">
                                <strong>Address: </strong>562 Wellington Road, Street 32, San Francisco
                            </p>
                            <p class="wow fadeIn animated">
                                <strong>Phone: </strong>+01 2222 365 /(+91) 01 2345 6789
                            </p>
                            <p class="wow fadeIn animated">
                                <strong>Hours: </strong>10:00 - 18:00, Mon - Sat
                            </p>
                            <h5 class="mb-10 mt-30 fw-600 text-grey-4 wow fadeIn animated">Follow Us</h5>
                            <div class="mobile-social-icon wow fadeIn animated mb-sm-5 mb-md-0">
                                <a href="#"><img src="assets/imgs/theme/icons/icon-facebook.svg" alt=""></a>
                                <a href="#"><img src="assets/imgs/theme/icons/icon-twitter.svg" alt=""></a>
                                <a href="#"><img src="assets/imgs/theme/icons/icon-instagram.svg" alt=""></a>
                                <a href="#"><img src="assets/imgs/theme/icons/icon-pinterest.svg" alt=""></a>
                                <a href="#"><img src="assets/imgs/theme/icons/icon-youtube.svg" alt=""></a>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-3">
                        <h5 class="widget-title wow fadeIn animated">About</h5>
                        <ul class="footer-list wow fadeIn animated mb-sm-5 mb-md-0">
                            <li><a href="#">About Us</a></li>
                            <li><a href="#">Delivery Information</a></li>
                            <li><a href="#">Privacy Policy</a></li>
                            <li><a href="#">Terms &amp; Conditions</a></li>
                            <li><a href="#">Contact Us</a></li>
                            <li><a href="#">Support Center</a></li>
                        </ul>
                    </div>
                    <div class="col-lg-2  col-md-3">
                        <h5 class="widget-title wow fadeIn animated">My Account</h5>
                        <ul class="footer-list wow fadeIn animated">
                            <li><a href="#">Sign In</a></li>
                            <li><a href="#">View Cart</a></li>
                            <li><a href="#">My Wishlist</a></li>
                            <li><a href="#">Track My Order</a></li>
                            <li><a href="#">Help</a></li>
                            <li><a href="#">Order</a></li>
                        </ul>
                    </div>
                    <div class="col-lg-4">
                        <h5 class="widget-title wow fadeIn animated">Install App</h5>
                        <div class="row">
                            <div class="col-md-8 col-lg-12">
                                <p class="wow fadeIn animated">From App Store or Google Play</p>
                                <div class="download-app wow fadeIn animated">
                                    <a href="#" class="hover-up mb-sm-4 mb-lg-0"><img class="active" src="assets/imgs/theme/app-store.jpg" alt=""></a>
                                    <a href="#" class="hover-up"><img src="assets/imgs/theme/google-play.jpg" alt=""></a>
                                </div>
                            </div>
                            <div class="col-md-4 col-lg-12 mt-md-3 mt-lg-0">
                                <p class="mb-20 wow fadeIn animated">Secured Payment Gateways</p>
                                <img class="wow fadeIn animated" src="assets/imgs/theme/payment-method.png" alt="">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <div class="container pb-20 wow fadeIn animated">
            <div class="row">
                <div class="col-12 mb-20">
                    <div class="footer-bottom"></div>
                </div>
                <div class="col-lg-6">
                    <p class="float-md-left font-sm text-muted mb-0">&copy; 2021, <strong class="text-brand">Evara</strong> - HTML Ecommerce Template </p>
                </div>
                <div class="col-lg-6">
                    <p class="text-lg-end text-start font-sm text-muted mb-0">
                        Designed by <a href="http://alithemes.com/" target="_blank">Alithemes.com</a>. All rights reserved
                    </p>
                </div>
            </div>
        </div>
    </footer>
    <!-- Preloader Start -->
    <div id="preloader-active">
        <div class="preloader d-flex align-items-center justify-content-center">
            <div class="preloader-inner position-relative">
                <div class="text-center">
                    <h5 class="mb-5">Now Loading</h5>
                    <div class="loader">
                        <div class="bar bar1"></div>
                        <div class="bar bar2"></div>
                        <div class="bar bar3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="paymentFailureModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>Payment Failed</h2>
            <p>We're sorry, but your payment was not completed. You can retry the payment or contact support for help.</p>
            <button id="retryPaymentButton" class="btn btn-primary">Retry Payment</button>
            <button onclick="closeModalfail()" class="btn btn-secondary">Cancel</button>
        </div>
    </div>

    <div id="toast-container" style="position: fixed; top: 10px; right: 10px; z-index: 1000;"></div>

    <!-- Vendor JS-->
    <script src="assets/js/vendor/modernizr-3.6.0.min.js"></script>
    <script src="assets/js/vendor/jquery-3.6.0.min.js"></script>
    <script src="assets/js/vendor/jquery-migrate-3.3.0.min.js"></script>
    <script src="assets/js/vendor/bootstrap.bundle.min.js"></script>
    <script src="assets/js/plugins/slick.js"></script>
    <script src="assets/js/plugins/jquery.syotimer.min.js"></script>
    <script src="assets/js/plugins/wow.js"></script>
    <script src="assets/js/plugins/jquery-ui.js"></script>
    <script src="assets/js/plugins/perfect-scrollbar.js"></script>
    <script src="assets/js/plugins/magnific-popup.js"></script>
    <script src="assets/js/plugins/select2.min.js"></script>
    <script src="assets/js/plugins/waypoints.js"></script>
    <script src="assets/js/plugins/counterup.js"></script>
    <script src="assets/js/plugins/jquery.countdown.min.js"></script>
    <script src="assets/js/plugins/images-loaded.js"></script>
    <script src="assets/js/plugins/isotope.js"></script>
    <script src="assets/js/plugins/scrollup.js"></script>
    <script src="assets/js/plugins/jquery.vticker-min.js"></script>
    <!-- Template  JS -->
    <script src="assets/js/main.js"></script>
    <script src="assets/js/shop.js"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>


   
    <script>
        window.onload = function () {
            const totalPriceText = document.getElementById('totalPrice').textContent.replace('₹', '').trim();
            const totalPrice = parseFloat(totalPriceText);
            const codOption = document.getElementById('paymentCOD');

            if (totalPrice > 1000) {
                codOption.disabled = true;
                const codLabel = document.querySelector('label[for="paymentCOD"]');
                codLabel.textContent += " (Unavailable for orders above ₹1000)";
            }
        };
    </script>

    <script>
        let selectedAddress; // Store selected address
        
// Update selected address variable on change
function updateSelectedAddress(addressID) {
    selectedAddress = addressID;
}

async function placeOrder() {
    // Get selected address or use the one from default load
    const addressID = selectedAddress || document.querySelector('input[name="addressID"]:checked')?.value;
    
    // Get selected payment option
    const paymentOption = document.querySelector('input[name="payment_option"]:checked')?.value;
    
    
    const code =  document.getElementById('couponCode').value;
    console.log(code,'codeee');
    const totalPriceText = document.getElementById('totalPrice').textContent.replace('₹', '').trim();
    const totalPrice = parseFloat(totalPriceText);
    console.log(totalPrice,'tt');
    
    const validationMessage = document.getElementById('validation-message');

    // Check if both address and payment option are selected
    if (!addressID || !paymentOption) {
        validationMessage.style.display = 'block';
        validationMessage.textContent = !addressID ? 'Please select an address.' : 'Please select a payment option.';
        
        // Scroll to the top to make the message visible
        validationMessage.scrollIntoView({ behavior: 'smooth' });
        return;
    }


    if(paymentOption==='COD' && totalPrice>1000){
        console.log('hiiii');
        
        validationMessage.style.display = 'block';
        validationMessage.textContent='COD is not allowed for orders above ₹1000. Please choose RazorPay.';
        validationMessage.scrollIntoView({ behavior: 'smooth' });
        return;
    }

    // Hide validation message if all required fields are selected
    validationMessage.style.display = 'none';

    // Handle Razorpay payment flow
    if (paymentOption === 'RazorPay') {
    try {
        const response = await fetch('/user/placeorder', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ addressID, payment_option: paymentOption, code })
        });

        const result = await response.json();

        if (result.success) {
            const options = {
                key: "<%= process.env.RAZORPAY_KEY_ID %>",
                amount: result.amount,
                currency: "INR",
                name: "EyeVogue",
                description: "Order Payment",
                order_id: result.razorpay_order_id,
                handler: async function (response) {
                    const verifyResponse = await fetch('/user/verify-payment', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            razorpay_order_id: response.razorpay_order_id,
                            razorpay_payment_id: response.razorpay_payment_id,
                            razorpay_signature: response.razorpay_signature,
                            orderId: result.orderId,
                            code: code,
                        })
                    });

                    const verifyResult = await verifyResponse.json();

                    if (verifyResult.success) {
                        window.location.href = `/user/orderconfirmed/${verifyResult.orderId}`;
                    } else {
                        showFailureModal(result.orderId);
                    }
                },
                prefill: {
                    name: "<%= user.name %>",
                    email: "<%= user.email %>",
                    contact: "<%= user.contact %>"
                },
                theme: { color: "#3399cc" },
                modal: {
                    ondismiss: async function () {
                        console.warn('Payment modal closed by user.');
                        await fetch('/user/payment-failed', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ orderId: result.orderId })
                        });
                        showFailureModal(result.orderId);
                    }
                }
            };

            const rzp = new Razorpay(options);
            rzp.open();
        } else {
            showValidationError('Failed to create payment order. Please try again.');
        }
    } catch (error) {
        console.error('Error with Razorpay payment:', error);
        showValidationError('Payment processing error. Please try again.');
    }

    


} 
    else {
        // Handle COD order placement
        try {
            const response = await fetch('/user/placeorder', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ addressID, payment_option: paymentOption ,code})
            });

            const result = await response.json();

            // Redirect to the confirmation page if successful
            if (result.success) {
                const id = result.orderId;
                window.location.href = `/user/orderconfirmed/${id}`;
            } else {
                validationMessage.style.display = 'block';
                validationMessage.textContent = 'Order failed: ' + result.message;
                validationMessage.scrollIntoView({ behavior: 'smooth' });
            }
        } catch (error) {
            console.error('Error placing order:', error);
        }
    }
}

function showFailureModal(orderId) {
    const failureModal = document.getElementById('paymentFailureModal');
    const retryButton = document.getElementById('retryPaymentButton');

    retryButton.onclick = function () {
        retryPayment(orderId);
    };

    failureModal.style.display = 'block';
}

function retryPayment(orderId) {
    fetch(`/user/retry-payment/${orderId}`, {
        method: 'POST',
    })
        .then(response => response.json())
        .then(result => {
            console.log(result, 'res');

            if (result.success) {
                // Construct the Razorpay options object
                const options = {
                    key: '<%= process.env.RAZORPAY_KEY_ID %>', // Replace with actual Razorpay Key
                    amount: result.amount, // Amount in paise
                    currency: 'INR',
                    name: 'EyeVogue',
                    description: 'Order Payment',
                    order_id: result.razorpay_order_id,
                    
                     // Razorpay order ID
                    handler: async function (response) {
                        console.log(response, 'response');

                        // Verify payment on the server
                        const verifyResponse = await fetch('/user/verify-payment', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                razorpay_order_id: response.razorpay_order_id,
                                razorpay_payment_id: response.razorpay_payment_id,
                                razorpay_signature: response.razorpay_signature,
                                orderId: result.orderId,
                                code:result.code,
                            }),
                        });

                        const verifyResult = await verifyResponse.json();

                        if (verifyResult.success) {
                            window.location.href = `/user/orderconfirmed/${verifyResult.orderId}`;
                        } else {
                            showFailureModal(result.orderId);
                        }
                    },
                    prefill: {
                        name: '<%= user.name %>', // Replace with actual user name
                        email: '<%= user.email %>', // Replace with actual user email
                        contact: '<%= user.contact %>', // Replace with actual user contact
                    },
                    theme: { color: '#3399cc' },
                    modal: {
                        ondismiss: async function () {
                        console.warn('Payment modal closed by user.');
                        await fetch('/user/payment-failed', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ orderId: result.orderId })
                        });
                        showFailureModal(orderId);
                    }
                    },
                };

                // Initialize Razorpay with the constructed options
                const rzp = new Razorpay(options);
                rzp.open();
                showToast('Retrying payment. Please complete the payment in the Razorpay window.', 'success');
            } else {
                showToast('Unable to retry payment. Please contact support.', 'error');
            }
        })
        .catch(error => {
            console.error('Error retrying payment:', error);
            showToast('Error occurred while retrying payment. Please try again.', 'error');
        });
}



function showToast(message, type = 'success') {
    let toastContainer = document.getElementById('toast-container');
    if (!toastContainer) {
        // Create the toast container if it doesn't exist
        toastContainer = document.createElement('div');
        toastContainer.id = 'toast-container';
        toastContainer.style.position = 'fixed';
        toastContainer.style.top = '10px';
        toastContainer.style.right = '10px';
        toastContainer.style.zIndex = '1000';
        document.body.appendChild(toastContainer);
    }

    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.innerText = message;

    toastContainer.appendChild(toast);

    // Remove the toast after 4 seconds
    setTimeout(() => {
        toast.remove();
    }, 4000);
}

    function closeModalfail() {
        console.log('hiiii');
        
            const failureModal = document.getElementById('paymentFailureModal');
            failureModal.style.display = 'none';
        }

    </script>
    <script>
        // Function to show available coupons in the modal
        function showAvailableCoupons() {
            const modal = document.getElementById('couponModal');
            const couponList = document.getElementById('couponList');
            couponList.innerHTML = '';  // Clear any previous content
    
            // Fetch available coupons from the backend
            fetch('/user/showcoupons')
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.coupons.length > 0) {
                        data.coupons.forEach(coupon => {
                            const couponItem = document.createElement('div');
                            couponItem.className = 'coupon-item';
                            couponItem.innerHTML = `
                                <p><strong>Code:</strong> ${coupon.code} - ${coupon.discountType === 'percentage' ? coupon.discountValue + '%' : '$' + coupon.discountValue}</p>
                                <p><small>Min Order: Rs${coupon.minOrderValue}</small></p>
                                <button onclick="applyCoupon('${coupon.code}')">Apply</button>
                            `;
                            couponList.appendChild(couponItem);
                        });
                    } else {
                        couponList.innerHTML = '<p>No coupons available for your cart total.</p>';
                    }
                    modal.style.display = 'block';  // Show the modal
                })
                .catch(error => {
                    console.error("Error fetching coupons:", error);
                    couponList.innerHTML = '<p>Error fetching available coupons.</p>';
                    modal.style.display = 'block';
                });
        }
    
        // Function to apply a coupon
        function applyCoupon(couponCode = null) {
            const code = couponCode || document.getElementById('couponCode').value;

            if (!code) {
                alert("Please enter or select a coupon code to apply.");
                return;
            }
    
            // Send the coupon code to the backend to apply it
            fetch('/user/applycoupon', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ code })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const couponAmount = document.getElementById('couponAmount')
                    const totalPrice = document.getElementById('totalPrice')
                    console.log(data);
                    
                    couponAmount.textContent = data.discountAmount.toFixed(2)
                    totalPrice.textContent = data.newTotal.toFixed(2)
                    document.getElementById('couponCode').value = code;
                   
                    alert("Coupon applied successfully! Discounted amount: Rs" + data.discountAmount);
                } else {
                    alert(data.message || "Failed to apply coupon.");
                }
            })
            .catch(error => {
                console.error("Error applying coupon:", error);
                alert("Server error while applying coupon.");
            });
        }
    
        // Function to remove the applied coupon
        function removeCoupon() {
            fetch('/user/removecoupon', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const couponAmount = document.getElementById('couponAmount')
                         const totalPrice = document.getElementById('totalPrice')
                        couponAmount.textContent = '0'
                        totalPrice.textContent = data.updatedCart.totalPrice

                        document.getElementById('couponCode').value = '';
                        alert("Coupon removed successfully!");
                    } else {
                        alert(data.message || "Failed to remove coupon.");
                    }
                })
                .catch(error => {
                    console.error("Error removing coupon:", error);
                    alert("Server error while removing coupon.");
                });
        }
    
        // Function to close the modal
        function closeModal() {
            document.getElementById('couponModal').style.display = 'none';
        }
    
        // Close modal if the user clicks outside the modal content
        window.onclick = function(event) {
            const modal = document.getElementById('couponModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }
    </script>
    
</body>


<!-- Mirrored from wp.alithemes.com/html/evara/evara-frontend/shop-checkout.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 01 Aug 2021 15:26:06 GMT -->
</html>